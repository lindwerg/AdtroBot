"""Horoscope generation utilities.

Phase 2: Mock horoscopes
Phase 5: AI-powered generation with fallback
"""

from datetime import date

from src.services.ai import get_ai_service

FALLBACK_MESSAGE = (
    "Сервис временно недоступен. Пожалуйста, попробуй через несколько минут.\n\n"
    "Иногда звезды молчат, чтобы мы прислушались к себе."
)


async def get_horoscope_text(zodiac_name: str, zodiac_name_ru: str) -> str:
    """Get horoscope text from AI (with caching) or return fallback.

    Args:
        zodiac_name: English name (e.g., "Aries")
        zodiac_name_ru: Russian name (e.g., "Овен")

    Returns:
        Horoscope text ready for display
    """
    ai = get_ai_service()
    date_str = date.today().strftime("%d.%m.%Y")

    text = await ai.generate_horoscope(zodiac_name, zodiac_name_ru, date_str)

    if text:
        return text

    return FALLBACK_MESSAGE


# ============== Legacy Mock Horoscopes (deprecated) ==============
# Kept for backwards compatibility. Use get_horoscope_text() instead.
MOCK_HOROSCOPES: dict[str, str] = {
    "Aries": (
        "\u2648 Сегодня звёзды благоволят новым начинаниям. Ваша энергия на пике, "
        "используйте её для решительных действий. Не бойтесь проявлять инициативу "
        "в делах, которые давно откладывали. Вечером возможна приятная неожиданность."
    ),
    "Taurus": (
        "\u2649 День благоприятен для финансовых вопросов и укрепления материальной "
        "базы. Ваша практичность поможет найти нестандартное решение. Уделите время "
        "близким людям — их поддержка сейчас особенно важна. Берегите энергию для "
        "важных дел."
    ),
    "Gemini": (
        "\u264a Коммуникации сегодня на высоте! Важные разговоры и переписки принесут "
        "пользу. Возможны интересные знакомства или новости от старых друзей. "
        "Доверяйте своей интуиции в выборе, с кем делиться идеями."
    ),
    "Cancer": (
        "\u264b Эмоциональный фон стабилен, что редко бывает. Воспользуйтесь этим "
        "для решения домашних вопросов. Семейные дела пойдут на лад, если проявить "
        "терпение. К вечеру возможно романтическое настроение."
    ),
    "Leo": (
        "\u264c Время блистать! Ваша харизма притягивает внимание и открывает двери. "
        "Творческие проекты получат новый импульс. Не скромничайте в самопрезентации, "
        "но помните о границах. Успех близок."
    ),
    "Virgo": (
        "\u264d Внимание к деталям сегодня принесёт плоды. Мелочи, которые вы обычно "
        "упускаете, могут оказаться ключом к успеху. Здоровье требует внимания — "
        "не игнорируйте сигналы тела. Вечером найдите время для отдыха."
    ),
    "Libra": (
        "\u264e Гармония в отношениях — ваш приоритет сегодня. Компромиссы возможны "
        "и даже необходимы. Эстетические удовольствия поднимут настроение. "
        "Финансовые вопросы лучше отложить на другой день."
    ),
    "Scorpio": (
        "\u264f Глубокие трансформации продолжаются. То, что казалось проблемой, "
        "может обернуться возможностью. Ваша проницательность поможет увидеть "
        "скрытые мотивы окружающих. Доверяйте интуиции, она не подведёт."
    ),
    "Sagittarius": (
        "\u2650 Жажда приключений зовёт вперёд! Новые горизонты манят, и это хороший "
        "день для планирования путешествий или обучения. Оптимизм заразителен — "
        "поделитесь им с окружающими. Избегайте поспешных обещаний."
    ),
    "Capricorn": (
        "\u2651 Карьерные вопросы выходят на первый план. Ваша дисциплина и упорство "
        "замечены руководством или партнёрами. Долгосрочные планы требуют корректировки. "
        "Не забывайте о личной жизни в погоне за успехом."
    ),
    "Aquarius": (
        "\u2652 Оригинальные идеи посещают вас чаще обычного. Не бойтесь экспериментировать "
        "и предлагать нестандартные решения. Друзья и единомышленники поддержат ваши "
        "начинания. Технологии и инновации — ваши союзники сегодня."
    ),
    "Pisces": (
        "\u2653 Интуиция сегодня особенно сильна. Прислушивайтесь к внутреннему голосу "
        "и сновидениям. Творческие занятия помогут выразить глубокие чувства. "
        "Избегайте конфликтов — ваша чувствительность обострена."
    ),
}


def get_mock_horoscope(zodiac_name: str) -> str:
    """Get mock horoscope text for a zodiac sign.

    DEPRECATED: Use get_horoscope_text() instead for AI-powered horoscopes.

    Args:
        zodiac_name: English name of zodiac sign (e.g., "Pisces")

    Returns:
        Russian horoscope text with zodiac emoji
    """
    return MOCK_HOROSCOPES.get(
        zodiac_name,
        "Звёзды сегодня хранят молчание. Попробуйте позже."
    )
