---
phase: 09-admin-panel
plan: 06
type: execute
wave: 3
depends_on: ["09-02", "09-04"]
files_modified:
  - admin-frontend/src/pages/Users.tsx
  - admin-frontend/src/pages/UserDetail.tsx
  - admin-frontend/src/api/endpoints/users.ts
  - admin-frontend/src/hooks/useUsers.ts
  - admin-frontend/src/routes/index.tsx
autonomous: true

must_haves:
  truths:
    - "Users page shows ProTable with pagination, filters, search"
    - "User detail page shows full profile with payment history"
    - "Admin can activate/cancel/extend subscription from user detail"
    - "Admin can gift premium/natal/spreads from user detail"
    - "Bulk selection allows actions on multiple users"
  artifacts:
    - path: "admin-frontend/src/pages/Users.tsx"
      provides: "Users list page with ProTable"
      exports: ["default"]
    - path: "admin-frontend/src/pages/UserDetail.tsx"
      provides: "User detail page with actions"
      exports: ["default"]
    - path: "admin-frontend/src/api/endpoints/users.ts"
      provides: "Users API client"
      exports: ["getUsers", "getUser", "updateSubscription", "giftUser"]
  key_links:
    - from: "admin-frontend/src/pages/Users.tsx"
      to: "admin-frontend/src/api/endpoints/users.ts"
      via: "API calls"
      pattern: "getUsers|useUsers"
---

<objective>
Build the users management UI with ProTable, filters, search, and user actions.

Purpose: Enable admin to find, view, and manage users and their subscriptions.
Output: Complete users list page and user detail page with all management actions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-admin-panel/09-CONTEXT.md
@.planning/phases/09-admin-panel/09-RESEARCH.md
@.planning/phases/09-admin-panel/09-02-SUMMARY.md
@.planning/phases/09-admin-panel/09-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Users API client and hooks</name>
  <files>
    - admin-frontend/src/api/endpoints/users.ts
    - admin-frontend/src/hooks/useUsers.ts
  </files>
  <action>
    1. Create admin-frontend/src/api/endpoints/users.ts:
       ```typescript
       import { api } from '@/api/client'

       export interface UserListItem {
         id: number
         telegram_id: number
         username: string | null
         zodiac_sign: string | null
         is_premium: boolean
         premium_until: string | null
         created_at: string
         tarot_spread_count: number
         daily_spread_limit: number
         detailed_natal_purchased_at: string | null
       }

       export interface UserListResponse {
         items: UserListItem[]
         total: number
         page: number
         page_size: number
         pages: number
       }

       export interface UserListParams {
         page?: number
         page_size?: number
         search?: string
         zodiac_sign?: string
         is_premium?: boolean
         has_detailed_natal?: boolean
         sort_by?: string
         sort_order?: 'asc' | 'desc'
       }

       export interface PaymentHistoryItem {
         id: string
         amount: number
         status: string
         description: string | null
         created_at: string
         paid_at: string | null
       }

       export interface SubscriptionInfo {
         id: number
         plan: string
         status: string
         started_at: string
         current_period_end: string
         canceled_at: string | null
       }

       export interface TarotSpreadHistoryItem {
         id: number
         spread_type: string
         question: string
         created_at: string
       }

       export interface UserDetail {
         id: number
         telegram_id: number
         username: string | null
         birth_date: string | null
         zodiac_sign: string | null
         birth_time: string | null
         birth_city: string | null
         timezone: string | null
         notifications_enabled: boolean
         notification_hour: number | null
         is_premium: boolean
         premium_until: string | null
         daily_spread_limit: number
         tarot_spread_count: number
         detailed_natal_purchased_at: string | null
         created_at: string
         subscription: SubscriptionInfo | null
         payments: PaymentHistoryItem[]
         recent_spreads: TarotSpreadHistoryItem[]
       }

       export interface UpdateSubscriptionRequest {
         action: 'activate' | 'cancel' | 'extend'
         days?: number
       }

       export interface GiftRequest {
         gift_type: 'premium_days' | 'detailed_natal' | 'tarot_spreads'
         value: number
       }

       export interface BulkActionRequest {
         user_ids: number[]
         action: 'activate_premium' | 'cancel_premium' | 'ban' | 'unban' | 'gift_spreads'
         value?: number
       }

       export interface BulkActionResponse {
         success_count: number
         failed_count: number
         errors: string[]
       }

       export async function getUsers(params: UserListParams = {}): Promise<UserListResponse> {
         const { data } = await api.get<UserListResponse>('/users', { params })
         return data
       }

       export async function getUser(userId: number): Promise<UserDetail> {
         const { data } = await api.get<UserDetail>(`/users/${userId}`)
         return data
       }

       export async function updateSubscription(userId: number, request: UpdateSubscriptionRequest): Promise<void> {
         await api.patch(`/users/${userId}/subscription`, request)
       }

       export async function giftUser(userId: number, request: GiftRequest): Promise<void> {
         await api.post(`/users/${userId}/gift`, request)
       }

       export async function bulkAction(request: BulkActionRequest): Promise<BulkActionResponse> {
         const { data } = await api.post<BulkActionResponse>('/users/bulk', request)
         return data
       }
       ```

    2. Create admin-frontend/src/hooks/useUsers.ts:
       ```typescript
       import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
       import { getUsers, getUser, updateSubscription, giftUser, bulkAction, UserListParams, UpdateSubscriptionRequest, GiftRequest, BulkActionRequest } from '@/api/endpoints/users'

       export function useUsers(params: UserListParams = {}) {
         return useQuery({
           queryKey: ['users', params],
           queryFn: () => getUsers(params),
         })
       }

       export function useUser(userId: number) {
         return useQuery({
           queryKey: ['user', userId],
           queryFn: () => getUser(userId),
           enabled: userId > 0,
         })
       }

       export function useUpdateSubscription() {
         const queryClient = useQueryClient()
         return useMutation({
           mutationFn: ({ userId, request }: { userId: number; request: UpdateSubscriptionRequest }) =>
             updateSubscription(userId, request),
           onSuccess: (_, { userId }) => {
             queryClient.invalidateQueries({ queryKey: ['user', userId] })
             queryClient.invalidateQueries({ queryKey: ['users'] })
           },
         })
       }

       export function useGiftUser() {
         const queryClient = useQueryClient()
         return useMutation({
           mutationFn: ({ userId, request }: { userId: number; request: GiftRequest }) =>
             giftUser(userId, request),
           onSuccess: (_, { userId }) => {
             queryClient.invalidateQueries({ queryKey: ['user', userId] })
             queryClient.invalidateQueries({ queryKey: ['users'] })
           },
         })
       }

       export function useBulkAction() {
         const queryClient = useQueryClient()
         return useMutation({
           mutationFn: (request: BulkActionRequest) => bulkAction(request),
           onSuccess: () => {
             queryClient.invalidateQueries({ queryKey: ['users'] })
           },
         })
       }
       ```
  </action>
  <verify>
    - TypeScript compiles without errors
    - Imports work correctly
  </verify>
  <done>Users API client and React Query hooks created</done>
</task>

<task type="auto">
  <name>Task 2: Users list page with ProTable</name>
  <files>
    - admin-frontend/src/pages/Users.tsx
  </files>
  <action>
    Create admin-frontend/src/pages/Users.tsx:
    ```tsx
    import { useState } from 'react'
    import { useNavigate } from 'react-router'
    import { ProTable, ProColumns } from '@ant-design/pro-components'
    import { Button, Tag, Space, message, Modal, InputNumber, Select } from 'antd'
    import { UserOutlined, GiftOutlined, ExportOutlined } from '@ant-design/icons'
    import dayjs from 'dayjs'
    import { getUsers, UserListItem, bulkAction } from '@/api/endpoints/users'

    const ZODIAC_SIGNS = [
      { value: 'aries', label: 'Овен' },
      { value: 'taurus', label: 'Телец' },
      { value: 'gemini', label: 'Близнецы' },
      { value: 'cancer', label: 'Рак' },
      { value: 'leo', label: 'Лев' },
      { value: 'virgo', label: 'Дева' },
      { value: 'libra', label: 'Весы' },
      { value: 'scorpio', label: 'Скорпион' },
      { value: 'sagittarius', label: 'Стрелец' },
      { value: 'capricorn', label: 'Козерог' },
      { value: 'aquarius', label: 'Водолей' },
      { value: 'pisces', label: 'Рыбы' },
    ]

    const columns: ProColumns<UserListItem>[] = [
      {
        dataIndex: 'telegram_id',
        title: 'Telegram ID',
        copyable: true,
        width: 120,
      },
      {
        dataIndex: 'username',
        title: 'Username',
        render: (_, record) => record.username || '—',
      },
      {
        dataIndex: 'zodiac_sign',
        title: 'Знак',
        valueType: 'select',
        valueEnum: Object.fromEntries(ZODIAC_SIGNS.map(z => [z.value, { text: z.label }])),
        width: 100,
      },
      {
        dataIndex: 'is_premium',
        title: 'Статус',
        valueType: 'select',
        valueEnum: {
          true: { text: 'Premium', status: 'Success' },
          false: { text: 'Free', status: 'Default' },
        },
        render: (_, record) => (
          <Tag color={record.is_premium ? 'gold' : 'default'}>
            {record.is_premium ? 'Premium' : 'Free'}
          </Tag>
        ),
        width: 100,
      },
      {
        dataIndex: 'premium_until',
        title: 'Premium до',
        valueType: 'dateTime',
        render: (_, record) =>
          record.premium_until ? dayjs(record.premium_until).format('DD.MM.YYYY') : '—',
        search: false,
        width: 110,
      },
      {
        dataIndex: 'tarot_spread_count',
        title: 'Раскладов',
        search: false,
        width: 90,
      },
      {
        dataIndex: 'detailed_natal_purchased_at',
        title: 'Детальная натальная',
        render: (_, record) => record.detailed_natal_purchased_at ? (
          <Tag color="purple">Куплена</Tag>
        ) : '—',
        valueType: 'select',
        valueEnum: {
          true: { text: 'Куплена' },
          false: { text: 'Нет' },
        },
        width: 130,
      },
      {
        dataIndex: 'created_at',
        title: 'Регистрация',
        valueType: 'dateTime',
        render: (_, record) => dayjs(record.created_at).format('DD.MM.YYYY'),
        search: false,
        sorter: true,
        width: 110,
      },
      {
        title: 'Действия',
        valueType: 'option',
        width: 80,
        render: (_, record) => [
          <Button
            key="view"
            type="link"
            size="small"
            icon={<UserOutlined />}
            onClick={() => window.location.href = `/users/${record.id}`}
          >
            Открыть
          </Button>,
        ],
      },
    ]

    export default function UsersPage() {
      const navigate = useNavigate()
      const [selectedRowKeys, setSelectedRowKeys] = useState<number[]>([])

      const handleBulkAction = async (action: string, value?: number) => {
        if (selectedRowKeys.length === 0) {
          message.warning('Выберите пользователей')
          return
        }

        try {
          const result = await bulkAction({
            user_ids: selectedRowKeys,
            action: action as any,
            value,
          })
          message.success(`Успешно: ${result.success_count}, ошибок: ${result.failed_count}`)
          setSelectedRowKeys([])
        } catch (error) {
          message.error('Ошибка выполнения')
        }
      }

      return (
        <ProTable<UserListItem>
          columns={columns}
          request={async (params, sort) => {
            const { current, pageSize, keyword, ...filters } = params
            const sortField = Object.keys(sort || {})[0]
            const sortOrder = sortField ? (sort[sortField] === 'descend' ? 'desc' : 'asc') : undefined

            try {
              const data = await getUsers({
                page: current,
                page_size: pageSize,
                search: keyword,
                zodiac_sign: filters.zodiac_sign,
                is_premium: filters.is_premium === 'true' ? true : filters.is_premium === 'false' ? false : undefined,
                has_detailed_natal: filters.detailed_natal_purchased_at === 'true' ? true : filters.detailed_natal_purchased_at === 'false' ? false : undefined,
                sort_by: sortField,
                sort_order: sortOrder,
              })
              return {
                data: data.items,
                total: data.total,
                success: true,
              }
            } catch {
              return { data: [], total: 0, success: false }
            }
          }}
          rowKey="id"
          pagination={{ pageSize: 20, showSizeChanger: true }}
          search={{ filterType: 'light' }}
          options={{
            search: { placeholder: 'Telegram ID или username' },
          }}
          rowSelection={{
            selectedRowKeys,
            onChange: (keys) => setSelectedRowKeys(keys as number[]),
          }}
          tableAlertOptionRender={() => (
            <Space>
              <Button size="small" onClick={() => handleBulkAction('activate_premium')}>
                Активировать Premium
              </Button>
              <Button size="small" onClick={() => handleBulkAction('cancel_premium')}>
                Отменить Premium
              </Button>
              <Button
                size="small"
                icon={<GiftOutlined />}
                onClick={() => {
                  Modal.confirm({
                    title: 'Подарить расклады',
                    content: (
                      <InputNumber
                        id="gift-spreads-count"
                        min={1}
                        max={100}
                        defaultValue={5}
                        style={{ width: '100%', marginTop: 8 }}
                      />
                    ),
                    onOk: () => {
                      const input = document.getElementById('gift-spreads-count') as HTMLInputElement
                      handleBulkAction('gift_spreads', parseInt(input?.value || '5'))
                    },
                  })
                }}
              >
                Подарить расклады
              </Button>
            </Space>
          )}
          onRow={(record) => ({
            onClick: () => navigate(`/users/${record.id}`),
            style: { cursor: 'pointer' },
          })}
          headerTitle="Пользователи"
          toolBarRender={() => [
            <Button key="export" icon={<ExportOutlined />}>
              Экспорт CSV
            </Button>,
          ]}
        />
      )
    }
    ```
  </action>
  <verify>
    - TypeScript compiles without errors
    - Page renders with ProTable
  </verify>
  <done>Users list page with ProTable, filters, search, and bulk actions</done>
</task>

<task type="auto">
  <name>Task 3: User detail page with actions</name>
  <files>
    - admin-frontend/src/pages/UserDetail.tsx
    - admin-frontend/src/routes/index.tsx
  </files>
  <action>
    1. Create admin-frontend/src/pages/UserDetail.tsx:
       ```tsx
       import { useParams, useNavigate } from 'react-router'
       import {
         Card, Descriptions, Tag, Button, Space, Divider,
         Table, Typography, message, Modal, InputNumber, Select, Spin, Alert
       } from 'antd'
       import {
         ArrowLeftOutlined, CrownOutlined, StopOutlined,
         GiftOutlined, MessageOutlined, CalendarOutlined
       } from '@ant-design/icons'
       import dayjs from 'dayjs'
       import { useUser, useUpdateSubscription, useGiftUser } from '@/hooks/useUsers'

       export default function UserDetailPage() {
         const { id } = useParams<{ id: string }>()
         const navigate = useNavigate()
         const userId = parseInt(id || '0')

         const { data: user, isLoading, error } = useUser(userId)
         const updateSubscription = useUpdateSubscription()
         const giftUser = useGiftUser()

         if (isLoading) return <Spin size="large" style={{ display: 'block', margin: '100px auto' }} />
         if (error || !user) return <Alert type="error" message="Пользователь не найден" showIcon />

         const handleActivate = () => {
           Modal.confirm({
             title: 'Активировать Premium?',
             content: 'Premium будет активирован на 30 дней',
             onOk: async () => {
               await updateSubscription.mutateAsync({ userId, request: { action: 'activate' } })
               message.success('Premium активирован')
             },
           })
         }

         const handleCancel = () => {
           Modal.confirm({
             title: 'Отменить Premium?',
             content: 'Premium доступ будет отключен немедленно',
             onOk: async () => {
               await updateSubscription.mutateAsync({ userId, request: { action: 'cancel' } })
               message.success('Premium отменен')
             },
           })
         }

         const handleExtend = () => {
           let days = 30
           Modal.confirm({
             title: 'Продлить Premium',
             content: (
               <InputNumber
                 min={1}
                 max={365}
                 defaultValue={30}
                 addonAfter="дней"
                 onChange={(v) => { days = v || 30 }}
                 style={{ width: '100%', marginTop: 8 }}
               />
             ),
             onOk: async () => {
               await updateSubscription.mutateAsync({ userId, request: { action: 'extend', days } })
               message.success(`Premium продлен на ${days} дней`)
             },
           })
         }

         const handleGift = (giftType: 'premium_days' | 'detailed_natal' | 'tarot_spreads') => {
           if (giftType === 'detailed_natal') {
             Modal.confirm({
               title: 'Подарить детальную натальную карту?',
               onOk: async () => {
                 await giftUser.mutateAsync({ userId, request: { gift_type: 'detailed_natal', value: 1 } })
                 message.success('Подарок отправлен')
               },
             })
             return
           }

           let value = giftType === 'premium_days' ? 30 : 5
           Modal.confirm({
             title: giftType === 'premium_days' ? 'Подарить Premium дни' : 'Подарить расклады',
             content: (
               <InputNumber
                 min={1}
                 max={giftType === 'premium_days' ? 365 : 100}
                 defaultValue={value}
                 addonAfter={giftType === 'premium_days' ? 'дней' : 'раскладов'}
                 onChange={(v) => { value = v || value }}
                 style={{ width: '100%', marginTop: 8 }}
               />
             ),
             onOk: async () => {
               await giftUser.mutateAsync({ userId, request: { gift_type: giftType, value } })
               message.success('Подарок отправлен')
             },
           })
         }

         return (
           <div>
             <Button
               type="link"
               icon={<ArrowLeftOutlined />}
               onClick={() => navigate('/users')}
               style={{ marginBottom: 16, paddingLeft: 0 }}
             >
               Назад к списку
             </Button>

             <Card
               title={
                 <Space>
                   <Typography.Text>Пользователь #{user.id}</Typography.Text>
                   {user.is_premium && <Tag color="gold">Premium</Tag>}
                 </Space>
               }
               extra={
                 <Space>
                   <Button icon={<MessageOutlined />}>Написать</Button>
                   {user.is_premium ? (
                     <>
                       <Button icon={<CalendarOutlined />} onClick={handleExtend}>Продлить</Button>
                       <Button danger icon={<StopOutlined />} onClick={handleCancel}>Отменить Premium</Button>
                     </>
                   ) : (
                     <Button type="primary" icon={<CrownOutlined />} onClick={handleActivate}>
                       Активировать Premium
                     </Button>
                   )}
                 </Space>
               }
             >
               <Descriptions column={{ xs: 1, sm: 2, md: 3 }} bordered size="small">
                 <Descriptions.Item label="Telegram ID">{user.telegram_id}</Descriptions.Item>
                 <Descriptions.Item label="Username">{user.username || '—'}</Descriptions.Item>
                 <Descriptions.Item label="Знак зодиака">{user.zodiac_sign || '—'}</Descriptions.Item>
                 <Descriptions.Item label="Дата рождения">
                   {user.birth_date ? dayjs(user.birth_date).format('DD.MM.YYYY') : '—'}
                 </Descriptions.Item>
                 <Descriptions.Item label="Время рождения">{user.birth_time || '—'}</Descriptions.Item>
                 <Descriptions.Item label="Город рождения">{user.birth_city || '—'}</Descriptions.Item>
                 <Descriptions.Item label="Часовой пояс">{user.timezone || '—'}</Descriptions.Item>
                 <Descriptions.Item label="Уведомления">
                   {user.notifications_enabled ? `Да, в ${user.notification_hour}:00` : 'Нет'}
                 </Descriptions.Item>
                 <Descriptions.Item label="Регистрация">
                   {dayjs(user.created_at).format('DD.MM.YYYY HH:mm')}
                 </Descriptions.Item>
                 <Descriptions.Item label="Premium до">
                   {user.premium_until ? dayjs(user.premium_until).format('DD.MM.YYYY HH:mm') : '—'}
                 </Descriptions.Item>
                 <Descriptions.Item label="Лимит раскладов/день">{user.daily_spread_limit}</Descriptions.Item>
                 <Descriptions.Item label="Раскладов сделано">{user.tarot_spread_count}</Descriptions.Item>
                 <Descriptions.Item label="Детальная натальная">
                   {user.detailed_natal_purchased_at ? (
                     <Tag color="purple">Куплена {dayjs(user.detailed_natal_purchased_at).format('DD.MM.YYYY')}</Tag>
                   ) : '—'}
                 </Descriptions.Item>
               </Descriptions>
             </Card>

             {/* Gifts section */}
             <Card title="Подарки" size="small" style={{ marginTop: 16 }}>
               <Space>
                 <Button icon={<GiftOutlined />} onClick={() => handleGift('premium_days')}>
                   Подарить Premium дни
                 </Button>
                 <Button icon={<GiftOutlined />} onClick={() => handleGift('tarot_spreads')}>
                   Подарить расклады
                 </Button>
                 {!user.detailed_natal_purchased_at && (
                   <Button icon={<GiftOutlined />} onClick={() => handleGift('detailed_natal')}>
                     Подарить детальную натальную
                   </Button>
                 )}
               </Space>
             </Card>

             {/* Payment history */}
             <Card title="История платежей" size="small" style={{ marginTop: 16 }}>
               <Table
                 dataSource={user.payments}
                 rowKey="id"
                 size="small"
                 pagination={false}
                 columns={[
                   { title: 'ID', dataIndex: 'id', width: 100, ellipsis: true },
                   {
                     title: 'Сумма',
                     dataIndex: 'amount',
                     render: (v) => `${(v / 100).toFixed(0)} RUB`,
                   },
                   {
                     title: 'Статус',
                     dataIndex: 'status',
                     render: (v) => (
                       <Tag color={v === 'succeeded' ? 'green' : v === 'pending' ? 'orange' : 'red'}>
                         {v}
                       </Tag>
                     ),
                   },
                   { title: 'Описание', dataIndex: 'description', ellipsis: true },
                   {
                     title: 'Дата',
                     dataIndex: 'paid_at',
                     render: (v, r) => dayjs(v || r.created_at).format('DD.MM.YYYY HH:mm'),
                   },
                 ]}
               />
             </Card>

             {/* Spread history */}
             <Card title="Последние расклады" size="small" style={{ marginTop: 16 }}>
               <Table
                 dataSource={user.recent_spreads}
                 rowKey="id"
                 size="small"
                 pagination={false}
                 columns={[
                   {
                     title: 'Тип',
                     dataIndex: 'spread_type',
                     render: (v) => v === 'celtic_cross' ? 'Кельтский крест' : '3 карты',
                   },
                   { title: 'Вопрос', dataIndex: 'question', ellipsis: true },
                   {
                     title: 'Дата',
                     dataIndex: 'created_at',
                     render: (v) => dayjs(v).format('DD.MM.YYYY HH:mm'),
                   },
                 ]}
               />
             </Card>
           </div>
         )
       }
       ```

    2. Update admin-frontend/src/routes/index.tsx to add UserDetail route:
       ```tsx
       import { createBrowserRouter, redirect } from 'react-router'
       import { useAuthStore } from '@/store/auth'
       import Layout from '@/components/Layout'
       import LoginPage from '@/pages/Login'
       import Dashboard from '@/pages/Dashboard'
       import UsersPage from '@/pages/Users'
       import UserDetailPage from '@/pages/UserDetail'

       // Auth check loader
       async function requireAuth() {
         const isAuthenticated = useAuthStore.getState().isAuthenticated()
         if (!isAuthenticated) {
           throw redirect('/login')
         }
         return null
       }

       // Redirect if already logged in
       async function redirectIfAuth() {
         const isAuthenticated = useAuthStore.getState().isAuthenticated()
         if (isAuthenticated) {
           throw redirect('/')
         }
         return null
       }

       export const router = createBrowserRouter([
         {
           path: '/login',
           element: <LoginPage />,
           loader: redirectIfAuth,
         },
         {
           path: '/',
           element: <Layout />,
           loader: requireAuth,
           children: [
             { index: true, element: <Dashboard /> },
             { path: 'users', element: <UsersPage /> },
             { path: 'users/:id', element: <UserDetailPage /> },
             { path: 'subscriptions', element: <div>Subscriptions (Coming soon)</div> },
             { path: 'payments', element: <div>Payments (Coming soon)</div> },
             { path: 'messages', element: <div>Messages (Coming soon)</div> },
             { path: 'promo-codes', element: <div>Promo Codes (Coming soon)</div> },
             { path: 'ab-tests', element: <div>A/B Tests (Coming soon)</div> },
           ],
         },
       ])
       ```
  </action>
  <verify>
    - TypeScript compiles without errors
    - /users page shows list with filters
    - Click on row navigates to /users/:id
    - User detail page shows all info
    - Subscription actions work (activate/cancel/extend)
    - Gift actions work
  </verify>
  <done>User detail page with subscription management and gift actions</done>
</task>

</tasks>

<verification>
1. Users page shows ProTable with all columns
2. Search works (telegram_id, username)
3. Filters work (zodiac, premium, detailed_natal)
4. Pagination works
5. Bulk selection and actions work
6. Click on row opens user detail
7. User detail shows full profile info
8. Subscription actions (activate/cancel/extend) work
9. Gift actions work
10. Payment and spread history displayed
</verification>

<success_criteria>
- ProTable with server-side pagination, filters, sorting
- Search by telegram_id or username
- Filters by zodiac, premium status, detailed_natal
- Bulk actions for selected users
- User detail with all profile fields
- Subscription management (activate/cancel/extend)
- Gift functionality (premium days, natal, spreads)
- Payment and spread history tables
</success_criteria>

<output>
After completion, create `.planning/phases/09-admin-panel/09-06-SUMMARY.md`
</output>
