---
phase: 09-admin-panel
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - admin-frontend/package.json
  - admin-frontend/vite.config.ts
  - admin-frontend/src/main.tsx
  - admin-frontend/src/App.tsx
  - admin-frontend/src/api/client.ts
  - admin-frontend/src/store/auth.ts
  - admin-frontend/src/routes/index.tsx
  - admin-frontend/src/pages/Login.tsx
  - admin-frontend/src/pages/Dashboard.tsx
  - admin-frontend/src/components/Layout.tsx
autonomous: true

must_haves:
  truths:
    - "Frontend dev server starts on localhost:5173"
    - "Login page accepts username/password and stores JWT"
    - "Protected routes redirect to login when not authenticated"
    - "Authenticated user sees Dashboard with placeholder content"
  artifacts:
    - path: "admin-frontend/package.json"
      provides: "Frontend dependencies"
      contains: "antd"
    - path: "admin-frontend/src/api/client.ts"
      provides: "Axios instance with JWT interceptor"
      exports: ["api"]
    - path: "admin-frontend/src/store/auth.ts"
      provides: "Auth state management"
      exports: ["useAuthStore"]
  key_links:
    - from: "admin-frontend/src/api/client.ts"
      to: "http://localhost:8000/admin"
      via: "axios baseURL"
      pattern: "baseURL.*localhost:8000"
    - from: "admin-frontend/src/routes/index.tsx"
      to: "admin-frontend/src/store/auth.ts"
      via: "auth check in loader"
      pattern: "useAuthStore|getState"
---

<objective>
Scaffold React frontend with Vite, Ant Design, and basic authentication flow.

Purpose: Create the admin SPA foundation with login, protected routes, and layout structure.
Output: Working frontend with login page that connects to backend /admin/token.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-admin-panel/09-CONTEXT.md
@.planning/phases/09-admin-panel/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vite React TypeScript project</name>
  <files>
    - admin-frontend/package.json
    - admin-frontend/vite.config.ts
    - admin-frontend/tsconfig.json
  </files>
  <action>
    1. Create the frontend project:
       ```bash
       cd /Users/kirill/Desktop/AdtroBot
       npm create vite@latest admin-frontend -- --template react-ts
       cd admin-frontend
       ```

    2. Install dependencies:
       ```bash
       npm install antd @ant-design/pro-components @ant-design/icons
       npm install recharts
       npm install react-router
       npm install axios @tanstack/react-query
       npm install dayjs
       npm install zustand
       ```

    3. Update vite.config.ts for API proxy:
       ```typescript
       import { defineConfig } from 'vite'
       import react from '@vitejs/plugin-react'
       import path from 'path'

       export default defineConfig({
         plugins: [react()],
         resolve: {
           alias: {
             '@': path.resolve(__dirname, './src'),
           },
         },
         server: {
           port: 5173,
           proxy: {
             '/admin': {
               target: 'http://localhost:8000',
               changeOrigin: true,
             },
           },
         },
       })
       ```

    4. Update tsconfig.json paths:
       ```json
       {
         "compilerOptions": {
           "baseUrl": ".",
           "paths": {
             "@/*": ["src/*"]
           }
         }
       }
       ```
  </action>
  <verify>
    - cd admin-frontend && npm run dev starts without errors
    - Browser opens to http://localhost:5173
  </verify>
  <done>Vite project created with all dependencies installed</done>
</task>

<task type="auto">
  <name>Task 2: Auth store and API client</name>
  <files>
    - admin-frontend/src/store/auth.ts
    - admin-frontend/src/api/client.ts
  </files>
  <action>
    1. Create admin-frontend/src/store/auth.ts:
       ```typescript
       import { create } from 'zustand'
       import { persist } from 'zustand/middleware'

       interface AuthState {
         token: string | null
         setToken: (token: string | null) => void
         logout: () => void
         isAuthenticated: () => boolean
       }

       export const useAuthStore = create<AuthState>()(
         persist(
           (set, get) => ({
             token: null,
             setToken: (token) => set({ token }),
             logout: () => set({ token: null }),
             isAuthenticated: () => get().token !== null,
           }),
           {
             name: 'admin-auth',
           }
         )
       )
       ```

    2. Create admin-frontend/src/api/client.ts:
       ```typescript
       import axios from 'axios'
       import { useAuthStore } from '@/store/auth'

       export const api = axios.create({
         baseURL: '/admin',
         headers: {
           'Content-Type': 'application/json',
         },
       })

       // Add auth token to requests
       api.interceptors.request.use((config) => {
         const token = useAuthStore.getState().token
         if (token) {
           config.headers.Authorization = `Bearer ${token}`
         }
         return config
       })

       // Handle 401 responses
       api.interceptors.response.use(
         (response) => response,
         (error) => {
           if (error.response?.status === 401) {
             useAuthStore.getState().logout()
             window.location.href = '/login'
           }
           return Promise.reject(error)
         }
       )
       ```
  </action>
  <verify>
    - TypeScript compiles without errors
    - Files import correctly
  </verify>
  <done>Auth store with persistence and API client with interceptors</done>
</task>

<task type="auto">
  <name>Task 3: Login page and routing</name>
  <files>
    - admin-frontend/src/pages/Login.tsx
    - admin-frontend/src/pages/Dashboard.tsx
    - admin-frontend/src/components/Layout.tsx
    - admin-frontend/src/routes/index.tsx
    - admin-frontend/src/main.tsx
    - admin-frontend/src/App.tsx
  </files>
  <action>
    1. Create admin-frontend/src/pages/Login.tsx:
       ```tsx
       import { LoginForm, ProFormText } from '@ant-design/pro-components'
       import { LockOutlined, UserOutlined } from '@ant-design/icons'
       import { useNavigate } from 'react-router'
       import { message } from 'antd'
       import { api } from '@/api/client'
       import { useAuthStore } from '@/store/auth'

       export default function LoginPage() {
         const navigate = useNavigate()
         const setToken = useAuthStore((s) => s.setToken)

         return (
           <div style={{
             display: 'flex',
             justifyContent: 'center',
             alignItems: 'center',
             minHeight: '100vh',
             background: '#f0f2f5',
           }}>
             <LoginForm
               title="AdtroBot Admin"
               subTitle="Панель администратора"
               onFinish={async (values) => {
                 try {
                   const formData = new URLSearchParams()
                   formData.append('username', values.username)
                   formData.append('password', values.password)

                   const { data } = await api.post('/token', formData, {
                     headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                   })

                   setToken(data.access_token)
                   message.success('Вход выполнен')
                   navigate('/')
                   return true
                 } catch (error) {
                   message.error('Неверный логин или пароль')
                   return false
                 }
               }}
             >
               <ProFormText
                 name="username"
                 fieldProps={{ size: 'large', prefix: <UserOutlined /> }}
                 placeholder="Логин"
                 rules={[{ required: true, message: 'Введите логин' }]}
               />
               <ProFormText.Password
                 name="password"
                 fieldProps={{ size: 'large', prefix: <LockOutlined /> }}
                 placeholder="Пароль"
                 rules={[{ required: true, message: 'Введите пароль' }]}
               />
             </LoginForm>
           </div>
         )
       }
       ```

    2. Create admin-frontend/src/pages/Dashboard.tsx:
       ```tsx
       import { Typography } from 'antd'

       export default function Dashboard() {
         return (
           <div>
             <Typography.Title level={2}>Dashboard</Typography.Title>
             <Typography.Paragraph>
               Здесь будет отображаться статистика и метрики.
             </Typography.Paragraph>
           </div>
         )
       }
       ```

    3. Create admin-frontend/src/components/Layout.tsx:
       ```tsx
       import { ProLayout, PageContainer } from '@ant-design/pro-components'
       import {
         DashboardOutlined,
         UserOutlined,
         CreditCardOutlined,
         MessageOutlined,
         GiftOutlined,
         ExperimentOutlined,
         LogoutOutlined,
       } from '@ant-design/icons'
       import { Outlet, useNavigate, useLocation } from 'react-router'
       import { useAuthStore } from '@/store/auth'

       const menuItems = [
         { path: '/', name: 'Dashboard', icon: <DashboardOutlined /> },
         { path: '/users', name: 'Пользователи', icon: <UserOutlined /> },
         { path: '/subscriptions', name: 'Подписки', icon: <CreditCardOutlined /> },
         { path: '/payments', name: 'Платежи', icon: <CreditCardOutlined /> },
         { path: '/messages', name: 'Сообщения', icon: <MessageOutlined /> },
         { path: '/promo-codes', name: 'Промокоды', icon: <GiftOutlined /> },
         { path: '/ab-tests', name: 'A/B тесты', icon: <ExperimentOutlined /> },
       ]

       export default function Layout() {
         const navigate = useNavigate()
         const location = useLocation()
         const logout = useAuthStore((s) => s.logout)

         return (
           <ProLayout
             title="AdtroBot"
             logo={false}
             location={{ pathname: location.pathname }}
             route={{
               path: '/',
               routes: menuItems.map((item) => ({
                 path: item.path,
                 name: item.name,
                 icon: item.icon,
               })),
             }}
             menuItemRender={(item, dom) => (
               <div onClick={() => navigate(item.path || '/')}>{dom}</div>
             )}
             avatarProps={{
               icon: <UserOutlined />,
               title: 'Admin',
               render: (_, dom) => dom,
             }}
             actionsRender={() => [
               <LogoutOutlined
                 key="logout"
                 onClick={() => {
                   logout()
                   navigate('/login')
                 }}
                 style={{ cursor: 'pointer' }}
               />,
             ]}
             fixedHeader
             fixSiderbar
           >
             <PageContainer>
               <Outlet />
             </PageContainer>
           </ProLayout>
         )
       }
       ```

    4. Create admin-frontend/src/routes/index.tsx:
       ```tsx
       import { createBrowserRouter, redirect } from 'react-router'
       import { useAuthStore } from '@/store/auth'
       import Layout from '@/components/Layout'
       import LoginPage from '@/pages/Login'
       import Dashboard from '@/pages/Dashboard'

       // Auth check loader
       async function requireAuth() {
         const isAuthenticated = useAuthStore.getState().isAuthenticated()
         if (!isAuthenticated) {
           throw redirect('/login')
         }
         return null
       }

       // Redirect if already logged in
       async function redirectIfAuth() {
         const isAuthenticated = useAuthStore.getState().isAuthenticated()
         if (isAuthenticated) {
           throw redirect('/')
         }
         return null
       }

       export const router = createBrowserRouter([
         {
           path: '/login',
           element: <LoginPage />,
           loader: redirectIfAuth,
         },
         {
           path: '/',
           element: <Layout />,
           loader: requireAuth,
           children: [
             { index: true, element: <Dashboard /> },
             { path: 'users', element: <div>Users Page (Coming soon)</div> },
             { path: 'users/:id', element: <div>User Detail (Coming soon)</div> },
             { path: 'subscriptions', element: <div>Subscriptions (Coming soon)</div> },
             { path: 'payments', element: <div>Payments (Coming soon)</div> },
             { path: 'messages', element: <div>Messages (Coming soon)</div> },
             { path: 'promo-codes', element: <div>Promo Codes (Coming soon)</div> },
             { path: 'ab-tests', element: <div>A/B Tests (Coming soon)</div> },
           ],
         },
       ])
       ```

    5. Update admin-frontend/src/main.tsx:
       ```tsx
       import React from 'react'
       import ReactDOM from 'react-dom/client'
       import { RouterProvider } from 'react-router'
       import { ConfigProvider } from 'antd'
       import ruRU from 'antd/locale/ru_RU'
       import dayjs from 'dayjs'
       import 'dayjs/locale/ru'
       import { router } from '@/routes'
       import '@ant-design/pro-components/dist/components.css'
       import './index.css'

       dayjs.locale('ru')

       ReactDOM.createRoot(document.getElementById('root')!).render(
         <React.StrictMode>
           <ConfigProvider locale={ruRU}>
             <RouterProvider router={router} />
           </ConfigProvider>
         </React.StrictMode>,
       )
       ```

    6. Update admin-frontend/src/App.tsx (can be minimal, routing handles everything):
       ```tsx
       export default function App() {
         return null
       }
       ```

    7. Update admin-frontend/src/index.css:
       ```css
       * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
       }

       body {
         font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
       }
       ```
  </action>
  <verify>
    - npm run dev starts
    - http://localhost:5173 redirects to /login
    - Login form displays correctly
    - After backend is running, login works and redirects to dashboard
  </verify>
  <done>Complete frontend scaffold with login, routing, and layout</done>
</task>

</tasks>

<verification>
1. cd admin-frontend && npm run dev starts without errors
2. Browser shows login page at /login
3. Unauthenticated access to / redirects to /login
4. Layout has sidebar navigation (placeholder pages)
5. Logout button in header works
</verification>

<success_criteria>
- Vite dev server runs on port 5173
- Login page styled with Ant Design
- Protected routes require authentication
- Sidebar navigation to all admin sections
- Russian locale applied
</success_criteria>

<output>
After completion, create `.planning/phases/09-admin-panel/09-02-SUMMARY.md`
</output>
